# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# Adding a new metric? We have docs for that!
# https://firefox-source-docs.mozilla.org/toolkit/components/glean/user/new_definitions_file.html

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0
$tags:
  - 'WebExtensions :: General'

extensions:
  use_remote_pref:
    type: boolean
    expires: never
    lifetime: application
    description: >
      Corresponds to the value of `extensions.webextensions.remote` pref.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1850351/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1850351#c2
    data_sensitivity:
      - technical

  use_remote_policy:
    type: boolean
    expires: never
    lifetime: application
    description: >
      Corresponds to the value of `WebExtensionPolicy.useRemoteWebExtensions`.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1850351/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1850351#c2
    data_sensitivity:
      - technical

  startup_cache_load_time:
    type: timespan
    time_unit: millisecond
    expires: never
    description: |
      Time to load and deserialize the extensions startupCache data.
    lifetime: application
    notification_emails:
      - addons-dev-internal@mozilla.com
      - lgreco@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1767336/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1767336#c7
    data_sensitivity:
      - technical
    telemetry_mirror: EXTENSIONS_STARTUPCACHE_LOAD_TIME
    no_lint:
      - GIFFT_NON_PING_LIFETIME

  startup_cache_read_errors:
    type: labeled_counter
    expires: never
    description: |
      The number of times an unexpected error has been raised while reading
      the extensions StartupCache file.
    lifetime: application
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1767336/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1767336#c7
    data_sensitivity:
      - technical
    telemetry_mirror: EXTENSIONS_STARTUPCACHE_READ_ERRORS
    no_lint:
      - GIFFT_NON_PING_LIFETIME

  startup_cache_write_bytelength:
    type: quantity
    unit: bytes
    expires: never
    description: |
       The amount of bytes written to the extensions StartupCache file.
    lifetime: application
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1767336/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1767336#c7
    data_sensitivity:
      - technical
    telemetry_mirror: EXTENSIONS_STARTUPCACHE_WRITE_BYTELENGTH
    no_lint:
      - GIFFT_NON_PING_LIFETIME

  process_event:
    type: labeled_counter
    expires: never
    description: |
      Counters for how many times the extension process has crashed or been created.
      The labels with "_fg" / "_bg" suffixes are only recorded in Android builds,
      while the "created" and "crashed" labels are recorded on both Desktop and Android
      builds.
    lifetime: application
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1830157/
      - https://bugzilla.mozilla.org/1848223/
      - https://bugzilla.mozilla.org/1850350/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1830157#c7
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1848223#c4
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1850350#c2
    data_sensitivity:
      - technical
    labels:
      - crashed_bg
      - crashed_fg
      - created_bg
      - created_fg
      - crashed_over_threshold_bg
      - crashed_over_threshold_fg

extensions.apis.dnr:

  startup_cache_read_size:
    type: memory_distribution
    memory_unit: byte
    expires: 155
    description: |
      Amount of data read from the DNR startup cache file.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: WEBEXT_DNR_STARTUPCACHE_READ_BYTES

  startup_cache_read_time:
    type: timing_distribution
    time_unit: millisecond
    expires: 155
    description: |
      Amount of time it takes to read data into the DNR startup cache file.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: WEBEXT_DNR_STARTUPCACHE_READ_MS

  startup_cache_write_size:
    type: memory_distribution
    memory_unit: byte
    expires: 155
    description: |
      Amount of data written to the DNR startup cache file.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: WEBEXT_DNR_STARTUPCACHE_WRITE_BYTES

  startup_cache_write_time:
    type: timing_distribution
    time_unit: millisecond
    expires: 155
    description: |
      Amount of time it takes to write data into the DNR startup cache file.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: WEBEXT_DNR_STARTUPCACHE_WRITE_MS

  startup_cache_entries:
    type: labeled_counter
    expires: 155
    description: |
      Counters for startup cache data hits or misses on initializating
      DNR rules for extensions loaded on application startup.
    lifetime: application
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    labels:
      - hit
      - miss
    telemetry_mirror: EXTENSIONS_APIS_DNR_STARTUP_CACHE_ENTRIES
    no_lint:
      - GIFFT_NON_PING_LIFETIME

  validate_rules_time:
    type: timing_distribution
    time_unit: millisecond
    expires: 155
    description: |
      Amount of time it takes to validate DNR rules of individual ruleset
      when dynamic or static rulesets have been loaded from disk.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: WEBEXT_DNR_VALIDATE_RULES_MS

  evaluate_rules_time:
    type: timing_distribution
    time_unit: millisecond
    expires: 155
    description: |
      Amount of time it takes to evaluate DNR rules for one network request.
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: WEBEXT_DNR_EVALUATE_RULES_MS

  evaluate_rules_count_max:
    type: quantity
    unit: rules
    expires: 155
    description: |
      Max amount of DNR rules being evaluated.
    lifetime: ping
    notification_emails:
      - addons-dev-internal@mozilla.com
    bugs:
      - https://bugzilla.mozilla.org/1803363/
      - https://bugzilla.mozilla.org/1850890/
      - https://bugzilla.mozilla.org/1881399/
      - https://bugzilla.mozilla.org/1946282/
      - https://bugzilla.mozilla.org/1984252/
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1803363#c11
    data_sensitivity:
      - technical
    telemetry_mirror: EXTENSIONS_APIS_DNR_EVALUATE_RULES_COUNT_MAX

extensions.data:

  migrate_result:
    type: event
    description: |
      These events are sent when an extension is migrating its data to the new
      IndexedDB backend.
    bugs:
      - https://bugzilla.mozilla.org/1470213
      - https://bugzilla.mozilla.org/1553297
      - https://bugzilla.mozilla.org/1590736
      - https://bugzilla.mozilla.org/1630596
      - https://bugzilla.mozilla.org/1672570
      - https://bugzilla.mozilla.org/1714251
      - https://bugzilla.mozilla.org/1749878
      - https://bugzilla.mozilla.org/1781974
      - https://bugzilla.mozilla.org/1817100
      - https://bugzilla.mozilla.org/1861295
      - https://bugzilla.mozilla.org/1912166
      - https://bugzilla.mozilla.org/1958151
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1470213#c15
    data_sensitivity:
      - technical
    notification_emails:
      - addons-dev-internal@mozilla.com
    extra_keys:
      addon_id:
        description: Id of the addon.
        type: string
      backend:
        description: The selected backend ("JSONFile" / "IndexedDB").
        type: string
      data_migrated:
        description: The old extension data has been migrated ("y" / "n").
        type: string
      error_name:
        description: |
          A DOMException error name if any ("OtherError" for unknown errors).
          The error has been fatal if the `backend` extra key is "JSONFile",
          otherwise it is a non fatal error which didn't prevented the
          extension from switching to the IndexedDB backend.
        type: string
      has_jsonfile:
        description: The extension has a JSONFile ("y" / "n").
        type: string
      has_olddata:
        description: Extension had some data stored in JSONFile ("y" / "n").
        type: string
    expires: 147

  storage_local_error:
    type: event
    description: |
      These events are collected when an extension triggers an unexpected error
      while running a storage.local API call (e.g. because of some underlying
      QuotaManager and/or IndexedDB error).
    bugs:
      - https://bugzilla.mozilla.org/1606903
      - https://bugzilla.mozilla.org/1649948
      - https://bugzilla.mozilla.org/1689255
      - https://bugzilla.mozilla.org/1730038
      - https://bugzilla.mozilla.org/1763523
      - https://bugzilla.mozilla.org/1811148
      - https://bugzilla.mozilla.org/1861297
      - https://bugzilla.mozilla.org/1912166
      - https://bugzilla.mozilla.org/1958151
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1606903#c3
    data_sensitivity:
      - technical
    notification_emails:
      - addons-dev-internal@mozilla.com
    extra_keys:
      addon_id:
        description: Id of the addon.
        type: string
      method:
        description: The storage.local API method name.
        type: string
      error_name:
        description: |
          A DOMException error name if any ("OtherError" for unknown errors).
        type: string
    expires: 147

  sync_usage_quotas:
    type: event
    description: |
      These events record the basic stat about usage, and are collected the
      first time an extension uses the sync storage API during a session.
    bugs:
      - https://bugzilla.mozilla.org/1915183
      - https://bugzilla.mozilla.org/1958156
    data_reviews:
      - https://phabricator.services.mozilla.com/D222442
    data_sensitivity:
      - technical
    notification_emails:
      - addons-dev-internal@mozilla.com
    extra_keys:
      addon_id:
        description: Id of the addon.
        type: string
      total_size_bytes:
        description: Size of the sync data.
        type: quantity
      items_count:
        description: Number of items in sync storage.
        type: quantity
      items_over_quota:
        description: Count of items larger than QUOTA_BYTES_PER_ITEM.
        type: quantity
      backend:
        description: Backend engine used, currently either "kinto" or "rust"
        type: string
    expires: 147

  migrate_result_count:
    type: labeled_counter
    description: >
      The number of times a storage.local backend data migration has been
      completed and results in one of the categories.

      This metric was generated to correspond to the Legacy Telemetry
      categorical histogram WEBEXT_STORAGE_LOCAL_IDB_MIGRATE_RESULT_COUNT.
    labels:
      - success
      - failure
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1465129
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1465129
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
    notification_emails:
      - addons-dev-internal@mozilla.com
      - lgreco@mozilla.com
    expires: 147
    telemetry_mirror: h#WEBEXT_STORAGE_LOCAL_IDB_MIGRATE_RESULT_COUNT

extensions.counters:

    browser_action_preload_result:
      type: labeled_counter
      expires: never
      description: |
        Number of times an event page hit the idle timeout and results in one of the labels.
      # Keep these labels in sync with the ones in WEBEXT_BROWSERACTION_POPUP_PRELOAD_RESULT_COUNT
      # as defined in Histograms.json
      labels:
        - popupShown
        - clearAfterHover
        - clearAfterMousedown
      lifetime: application
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1297167
        - https://bugzilla.mozilla.org/1513556
        - https://bugzilla.mozilla.org/1578225
        - https://bugzilla.mozilla.org/1623315
        - https://bugzilla.mozilla.org/1666980
        - https://bugzilla.mozilla.org/1706839
        - https://bugzilla.mozilla.org/1745271
        - https://bugzilla.mozilla.org/1777402
        - https://bugzilla.mozilla.org/1811155
        - https://bugzilla.mozilla.org/1861303
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: h#WEBEXT_BROWSERACTION_POPUP_PRELOAD_RESULT_COUNT
      no_lint:
        - GIFFT_NON_PING_LIFETIME

    browser_action_preload_result_by_addonid:
      type: dual_labeled_counter
      description: >
        The number of times a browserAction popup is preloaded and results in one
        of the categories, keyed by addon id.

        This metric was generated to correspond to the Legacy Telemetry
        categorical histogram
        WEBEXT_BROWSERACTION_POPUP_PRELOAD_RESULT_COUNT_BY_ADDONID.
      dual_labels:
        key:
          description: addon id.
        category:
          labels:
            - popupShown
            - clearAfterHover
            - clearAfterMousedown
          description: Labels of the keyed categorical legacy telemetry histogram
            WEBEXT_BROWSERACTION_POPUP_PRELOAD_RESULT_COUNT_BY_ADDONID.
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958168
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1960567
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958168
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_BROWSERACTION_POPUP_PRELOAD_RESULT_COUNT_BY_ADDONID

    event_page_idle_result:
      type: labeled_counter
      expires: never
      description: |
        Number of times an event page hit the idle timeout and results in one of the labels.
      # Keep these labels in sync with the ones in WEBEXT_EVENTPAGE_IDLE_RESULT_COUNT
      # as defined in Histograms.json
      labels:
        - suspend
        - reset_other
        - reset_event
        - reset_listeners
        - reset_nativeapp
        - reset_streamfilter
        - reset_parentapicall
        - permissions_request
        - launchWebAuthFlow
      lifetime: application
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1787940
        - https://bugzilla.mozilla.org/1817103
        - https://bugzilla.mozilla.org/1861303
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: h#WEBEXT_EVENTPAGE_IDLE_RESULT_COUNT
      no_lint:
        - GIFFT_NON_PING_LIFETIME

    event_page_idle_result_by_addonid:
      type: dual_labeled_counter
      description: >
        The number of times an event page hit the idle timeout and results in one
        of the categories, keyed by addon id.

        This metric was generated to correspond to the Legacy Telemetry
        categorical histogram WEBEXT_EVENTPAGE_IDLE_RESULT_COUNT_BY_ADDONID.
      dual_labels:
        key:
          description: addon id.
        category:
          labels:
            - suspend
            - reset_other
            - reset_event
            - reset_listeners
            - reset_nativeapp
            - reset_streamfilter
            - reset_parentapicall
            - permissions_request
            - launchWebAuthFlow
          description: Labels of the keyed categorical legacy telemetry histogram
            WEBEXT_EVENTPAGE_IDLE_RESULT_COUNT_BY_ADDONID.
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1787940
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1817103
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958168
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1960567
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1787940
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1817103
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958168
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_EVENTPAGE_IDLE_RESULT_COUNT_BY_ADDONID

extensions.timing:

    background_page_load:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes to load a WebExtensions background page, from when the
        build function is called to when the page has finished processing the onload event.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1353172
        - https://bugzilla.mozilla.org/1489524
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_BACKGROUND_PAGE_LOAD_MS

    background_page_load_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes to load a WebExtensions background page, from
        when the build function is called to when the page has finished processing
        the onload event, keyed by addon id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_BACKGROUND_PAGE_LOAD_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_BACKGROUND_PAGE_LOAD_MS_BY_ADDONID

    browser_action_popup_open:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes for a BrowserAction popup to open.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1297167
        - https://bugzilla.mozilla.org/1513556
        - https://bugzilla.mozilla.org/1578225
        - https://bugzilla.mozilla.org/1623315
        - https://bugzilla.mozilla.org/1666980
        - https://bugzilla.mozilla.org/1706839
        - https://bugzilla.mozilla.org/1745271
        - https://bugzilla.mozilla.org/1777402
        - https://bugzilla.mozilla.org/1811155
        - https://bugzilla.mozilla.org/1861303
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_BROWSERACTION_POPUP_OPEN_MS

    browser_action_popup_open_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes for a BrowserAction popup to open, keyed by
        addon id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_BROWSERACTION_POPUP_OPEN_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_BROWSERACTION_POPUP_OPEN_MS_BY_ADDONID

    content_script_injection:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes for content scripts from a WebExtension to be injected into a window.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1356323
        - https://bugzilla.mozilla.org/1489524
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_CONTENT_SCRIPT_INJECTION_MS

    content_script_injection_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes for content scripts from a WebExtension to be
        injected into a window, keyed by addon id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_CONTENT_SCRIPT_INJECTION_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_CONTENT_SCRIPT_INJECTION_MS_BY_ADDONID

    event_page_running_time:
      type: custom_distribution
      unit: ms
      range_min: 1
      range_max: 60000
      bucket_count: 100
      histogram_type: exponential
      expires: never
      description: |
        Amount of time (keyed by addon id) that an event page has been running before being suspended,
        or the entire addon shutdown.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1787940
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_EVENTPAGE_RUNNING_TIME_MS

    event_page_running_time_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time (keyed by addon id) that an event page has been running
        before being suspended, or the entire addon shutdown.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_EVENTPAGE_RUNNING_TIME_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1787940
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1817103
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1787940
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1817103
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_EVENTPAGE_RUNNING_TIME_MS_BY_ADDONID

    extension_startup:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes for a WebExtension to start up, from when the
        startup function is called to when the startup promise resolves.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1353171
        - https://bugzilla.mozilla.org/1489524
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_EXTENSION_STARTUP_MS

    extension_startup_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes for a WebExtension to start up, from when the
        startup function is called to when the startup promise resolves, keyed by
        addon id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_EXTENSION_STARTUP_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_EXTENSION_STARTUP_MS_BY_ADDONID

    page_action_popup_open:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes for a PageAction popup to open.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1297167
        - https://bugzilla.mozilla.org/1513556
        - https://bugzilla.mozilla.org/1578225
        - https://bugzilla.mozilla.org/1623315
        - https://bugzilla.mozilla.org/1666980
        - https://bugzilla.mozilla.org/1706839
        - https://bugzilla.mozilla.org/1745271
        - https://bugzilla.mozilla.org/1777402
        - https://bugzilla.mozilla.org/1811155
        - https://bugzilla.mozilla.org/1861303
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_PAGEACTION_POPUP_OPEN_MS

    page_action_popup_open_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes for a PageAction popup to open, keyed by addon
        id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_PAGEACTION_POPUP_OPEN_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_PAGEACTION_POPUP_OPEN_MS_BY_ADDONID

    storage_local_get_idb:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes to perform a get via storage.local using the IndexedDB backend.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1465120
        - https://bugzilla.mozilla.org/1513556
        - https://bugzilla.mozilla.org/1578225
        - https://bugzilla.mozilla.org/1623315
        - https://bugzilla.mozilla.org/1666980
        - https://bugzilla.mozilla.org/1706839
        - https://bugzilla.mozilla.org/1745271
        - https://bugzilla.mozilla.org/1777402
        - https://bugzilla.mozilla.org/1811155
        - https://bugzilla.mozilla.org/1861303
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_STORAGE_LOCAL_IDB_GET_MS

    storage_local_get_idb_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes to perform a get via storage.local using the
        IndexedDB backend, keyed by addon id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_STORAGE_LOCAL_IDB_GET_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_STORAGE_LOCAL_IDB_GET_MS_BY_ADDONID

    storage_local_set_idb:
      type: timing_distribution
      time_unit: millisecond
      expires: never
      description: |
        Amount of time it takes to perform a set via storage.local using the Indexed backend.
      notification_emails:
        - addons-dev-internal@mozilla.com
      bugs:
        - https://bugzilla.mozilla.org/1465120
        - https://bugzilla.mozilla.org/1513556
        - https://bugzilla.mozilla.org/1578225
        - https://bugzilla.mozilla.org/1623315
        - https://bugzilla.mozilla.org/1666980
        - https://bugzilla.mozilla.org/1706839
        - https://bugzilla.mozilla.org/1745271
        - https://bugzilla.mozilla.org/1777402
        - https://bugzilla.mozilla.org/1811155
        - https://bugzilla.mozilla.org/1861303
        - https://bugzilla.mozilla.org/1820158
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1820158#c8
      data_sensitivity:
        - technical
      telemetry_mirror: WEBEXT_STORAGE_LOCAL_IDB_SET_MS

    storage_local_set_idb_by_addonid:
      type: labeled_timing_distribution
      description: >
        The amount of time it takes to perform a set via storage.local using the
        IndexedDB backend, keyed by addon id.

        This metric was generated to correspond to the Legacy Telemetry
        exponential histogram WEBEXT_STORAGE_LOCAL_IDB_SET_MS_BY_ADDONID.
      time_unit: millisecond
      bugs:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1958154
      data_reviews:
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1483002
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1513556
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1578225
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1623315
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1666980
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1706839
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1745271
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1777402
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1811155
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1861303
        - https://bugzilla.mozilla.org/show_bug.cgi?id=1912170
      notification_emails:
        - addons-dev-internal@mozilla.com
        - lgreco@mozilla.com
      expires: 147
      telemetry_mirror: WEBEXT_STORAGE_LOCAL_IDB_SET_MS_BY_ADDONID
